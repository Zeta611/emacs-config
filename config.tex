% Created 2022-06-24 Fri 18:50
% Intended LaTeX compiler: xelatex
\documentclass[a4paper,11pt]{article}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage{kotex}
\RequirePackage[math-style=TeX,bold-style=TeX]{unicode-math}
\setmainfont{Libertinus Serif}
\setsansfont{Libertinus Sans}[Scale=MatchUppercase]
\setmonofont{Inconsolata}[Scale=MatchLowercase]
\setmathfont{Libertinus Math}[Scale=MatchUppercase] % Before set*hangulfont
\setmainhangulfont{Noto Serif CJK KR}[Scale=.885]
\setsanshangulfont[BoldFont={* Bold}]{KoPubWorldDotum_Pro}[Scale=.885]
\setmonohangulfont{D2Coding}[Scale=MatchLowercase]
\author{Jay Lee}
\date{\today}
\title{My Emacs config}
\hypersetup{
 pdfauthor={Jay Lee},
 pdftitle={My Emacs config},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 28.1 (Org mode 9.5.2)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents


\section{Package management}
\label{sec:org7321f26}
\subsection{MELPA}
\label{sec:orgab89452}
\begin{verbatim}
(require 'package)
(add-to-list 'package-archives
	     '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)
\end{verbatim}

\subsection{Better package setup}
\label{sec:org661f742}
Use \texttt{use-package}
\begin{verbatim}
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))
(eval-and-compile
  ; Always make sure packages are installed correctly at every startup
  (setq use-package-always-ensure t
	use-package-expand-minimally t))
\end{verbatim}

\subsection{Modernized package menu}
\label{sec:org2df647e}
Use \texttt{paradox}.
\begin{verbatim}
(use-package paradox
  :ensure t
  :init (paradox-enable))
\end{verbatim}

\section{Pretty Emacs}
\label{sec:orge9856ad}
\subsection{Theme}
\label{sec:org46f1769}
Although \href{https://github.blog/2022-06-08-sunsetting-atom/}{Atom is being sunset by GitHub}, the default theme it provided is one of the best-looking and easy-on-the-eyes color scheme out in the wild.
\texttt{doom-one} theme is more actively maintained than \texttt{atom-one-dark-theme}.
\begin{verbatim}
(use-package doom-themes
  :ensure t
  :config
  (setq doom-themes-enable-bold t
    doom-themes-enable-italic t)
  (load-theme 'doom-one t))
\end{verbatim}

\subsection{Font}
\label{sec:orgd7cb2ba}
JuliaMono provides the most comprehensive unicode support.
\begin{verbatim}
(set-frame-font "JuliaMono 15" nil t)
; Apply the font to emacsclients
(add-to-list 'default-frame-alist '(font . "JuliaMono 15"))
\end{verbatim}

Use D2Coding for hangul (Korean letters).
To reliably set a hangul font, it needs to be run lately.
I did not experiment with the earliest possible stage it needs to run, but it does work when run in a hook `after-make-frame-functions`.
\begin{verbatim}
(defun set-hangul-font (_)
  (set-fontset-font t 'hangul (font-spec :name "D2Coding"))
  (setq face-font-rescale-alist '(("D2Coding" . 1.2))))
(add-to-list 'after-make-frame-functions #'set-hangul-font)
\end{verbatim}

D2Coding is scaled so that a single Korean letter corresponds to two ASCII letters:
\begin{center}
\begin{tabular}{ll}
English & Korean\\
\hline
Emacs & 이맥스\\
Vim & 빔\\
\end{tabular}
\end{center}

\subsection{Icons}
\label{sec:orga6d8cf0}
\begin{verbatim}
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p))
\end{verbatim}

\subsection{Modeline Theme}
\label{sec:org57eff75}
\begin{verbatim}
(use-package doom-modeline
  :ensure t
  :hook (after-init . doom-modeline-mode))
\end{verbatim}

\subsection{File explorer}
\label{sec:orgfb9c1ed}
A Tree layout file explorer.
\begin{verbatim}
(use-package treemacs
  :ensure t
  :bind
  (:map global-map
    ("M-0"       . treemacs-select-window)
    ("C-x t 1"   . treemacs-delete-other-windows)
    ("C-x t t"   . treemacs)
    ("C-x t d"   . treemacs-select-directory)
    ("C-x t B"   . treemacs-bookmark)
    ("C-x t C-t" . treemacs-find-file)
    ("C-x t M-t" . treemacs-find-tag)))

(use-package treemacs-icons-dired
  :hook (dired-mode . treemacs-icons-dired-enable-once)
  :ensure t)

(use-package treemacs-magit
  :after (treemacs magit)
  :ensure t)
\end{verbatim}

\subsection{Miscellaneous}
\label{sec:org043520c}
Seamless title bar in macOS.
\begin{verbatim}
(tool-bar-mode -1)
(use-package ns-auto-titlebar
  :ensure t
  :config (ns-auto-titlebar-mode))
\end{verbatim}

Also remove the excessive scroll bar.
\begin{verbatim}
(scroll-bar-mode -1)
\end{verbatim}

Line numbering.
\begin{verbatim}
(global-display-line-numbers-mode)
(setq display-line-numbers-type 'relative)
\end{verbatim}

Get rid of irritating beep-boops.
\begin{verbatim}
(defun flash-mode-line ()
  (invert-face 'mode-line)
  (run-with-timer 0.1 nil #'invert-face 'mode-line))
(setq visible-bell nil ring-bell-function #'flash-mode-line)
\end{verbatim}

Prettify symbols.
\begin{verbatim}
(global-prettify-symbols-mode 1)
\end{verbatim}

Dashboard.
\begin{verbatim}
;; (use-package page-break-lines
;;   :ensure t)

(use-package dashboard
  :ensure t
  :config
  (dashboard-setup-startup-hook)
  ; show dashboard after emacsclient -c
  (setq initial-buffer-choice
    (lambda () (get-buffer-create "*dashboard*")))

  (setq dashboard-banner-logo-title "Hi, Jay!")
  (setq dashboard-startup-banner "blackhole-lines.svg")
  (setq dashboard-image-banner-max-width 512)
  (setq dashboard-image-banner-max-height 512)
  (setq dashboard-center-content t)
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t))
\end{verbatim}

\section{Key bindings}
\label{sec:org716e3e7}
\subsection{Hints}
\label{sec:org59e68b4}
Show what key bindings are available.
\begin{verbatim}
(use-package which-key
  :ensure t
  :config (which-key-mode))
\end{verbatim}

Show completions.
\begin{verbatim}
(use-package ivy
  :ensure t
  :config
  (ivy-mode)
  (setq ivy-use-virtual-buffers t))
\end{verbatim}

\subsection{Navigation}
\label{sec:orgc4c53c5}
Incremental search using ivy.
\begin{verbatim}
(use-package swiper
  :ensure t
  :after ivy
  :bind ("C-s" . swiper-isearch))
\end{verbatim}

Use numbering to move frames.
\begin{verbatim}
(use-package window-numbering
  :ensure t
  :config (window-numbering-mode))
\end{verbatim}

\subsection{Miscellaneous}
\label{sec:org2fb39c4}
Use command as meta in macOS.
\begin{verbatim}
(setq mac-command-modifier 'meta)
\end{verbatim}

Stop fighting indentation in Org mode code snippets.
\begin{verbatim}
(setq org-adapt-indentation nil)
\end{verbatim}

\section{Languages}
\label{sec:orgefe4176}
\subsection{Tools}
\label{sec:org5b0532d}
Syntax checking.
\begin{verbatim}
(use-package flycheck
  :ensure t
  :init (global-flycheck-mode))
\end{verbatim}

Completion
\begin{verbatim}
(use-package company
  :ensure t
  :init (global-company-mode))
\end{verbatim}

\subsubsection{Language server protocol}
\label{sec:org4927f6f}
Settings for LSP.
\begin{verbatim}
(use-package lsp-mode
  :ensure t
  :init (setq lsp-keymap-prefix "C-c l")
  :hook
  ((tuareg-mode . lsp)
   (lsp-mode . lsp-enable-which-key-integration))
  :commands lsp)

(use-package lsp-ui
  :ensure t
  :after lsp-mode
  :config
  (setq lsp-ui-doc-show-with-cursor t))

(use-package lsp-ivy
  :ensure t
  :after (lsp-mode ivy)
  :commands lsp-ivy-workspace-symbol)

;; (use-package lsp-treemacs
;;   :ensure t
;;   :after (lsp-mode treemacs)
;;   :commands lsp-treemacs-errors-list)
\end{verbatim}

\subsection{Lisps}
\label{sec:orged910cc}
Pseudo-structural editing.
\begin{verbatim}
(use-package paredit
  :ensure t
  :init
  (autoload 'enable-paredit-mode "paredit"
    "Turn on pseudo-structural editing of Lisp code."
    t)
  :config
  (add-hook 'emacs-lisp-mode-hook #'enable-paredit-mode)
  (add-hook 'eval-expression-minibuffer-setup-hook #'enable-paredit-mode)
  (add-hook 'ielm-mode-hook #'enable-paredit-mode)
  (add-hook 'lisp-mode-hook #'enable-paredit-mode)
  (add-hook 'lisp-interaction-mode-hook #'enable-paredit-mode)
  (add-hook 'scheme-mode-hook #'enable-paredit-mode))
\end{verbatim}

Prettify lambda.
\begin{verbatim}
(defun prettify-lambda ()
  "Prettify lambda"
  (push '("lambda" . 955) prettify-symbols-alist))
\end{verbatim}

\subsubsection{Scheme}
\label{sec:org809936e}
Set scheme interpreter to Chicken Scheme.
\begin{verbatim}
(setq scheme-program-name "csi")
\end{verbatim}

Use \texttt{geiser}.
\begin{verbatim}
(use-package geiser-chicken
  :ensure t)
\end{verbatim}

Prettify symbols.
\begin{verbatim}
(add-hook 'scheme-mode-hook #'prettify-lambda)
\end{verbatim}

\subsection{OCaml}
\label{sec:orgb79d180}
These packages are installed via `opam`, not from MELPA.
\begin{verbatim}
(require 'opam-user-setup "~/.emacs.d/opam-user-setup.el")
(use-package ocamlformat
  :ensure nil
  :custom (ocamlformat-enable 'enable-outside-detected-project)
  :bind (:map tuareg-mode-map
	      ("C-M-<tab>" . ocamlformat))
  :hook (before-save . ocamlformat-before-save))
\end{verbatim}

Better error message.
\begin{verbatim}
(defun set-ocaml-error-regexp ()
  (set
   'compilation-error-regexp-alist
   (list '("[Ff]ile \\(\"\\(.*?\\)\", line \\(-?[0-9]+\\)\\(, characters \\(-?[0-9]+\\)-\\([0-9]+\\)\\)?\\)\\(:\n\\(\\(Warning .*?\\)\\|\\(Error\\)\\):\\)?"
    2 3 (5 . 6) (9 . 11) 1 (8 compilation-message-face)))))

(add-hook 'tuareg-mode-hook #'set-ocaml-error-regexp)
(add-hook 'caml-mode-hook #'set-ocaml-error-regexp)
\end{verbatim}

\subsection{Python}
\label{sec:org83ad87f}
Use \texttt{elpy}.
\begin{verbatim}
(use-package elpy
  :ensure t
  :init (elpy-enable))
\end{verbatim}

\subsection{Org mode}
\label{sec:org91ddd18}
Font size and symbols.
\begin{verbatim}
(use-package org-superstar
  :ensure t
  :config
  ;; hide #+TITLE:
  (setq org-hidden-keywords '(title))
  ;; set basic title font
  (set-face-attribute 'org-level-8 nil :weight 'bold :inherit 'default)
  ;; Low levels are unimportant = no scaling
  (set-face-attribute 'org-level-7 nil :inherit 'org-level-8)
  (set-face-attribute 'org-level-6 nil :inherit 'org-level-8)
  (set-face-attribute 'org-level-5 nil :inherit 'org-level-8)
  (set-face-attribute 'org-level-4 nil :inherit 'org-level-8)
  ;; Top ones get scaled the same as in LaTeX (\large, \Large, \LARGE)
  (set-face-attribute 'org-level-3 nil :inherit 'org-level-8 :height 1.2) ;\large
  (set-face-attribute 'org-level-2 nil :inherit 'org-level-8 :height 1.44) ;\Large
  (set-face-attribute 'org-level-1 nil :inherit 'org-level-8 :height 1.728) ;\LARGE
  ;; Only use the first 4 styles and do not cycle.
  (setq org-cycle-level-faces nil)
  (setq org-n-level-faces 4)
  ;; Document Title, (\huge)
  (set-face-attribute 'org-document-title nil
		      :height 2.074
		      :foreground 'unspecified
		      :inherit 'org-level-8)
  (add-hook 'org-mode-hook (lambda () (org-superstar-mode 1))))
\end{verbatim}

Prettify symbols.
\begin{verbatim}
(add-hook
 'org-mode-hook
 (lambda ()
   "Prettify Org mode symbols"
   (push '("[ ]" . "☐") prettify-symbols-alist)
   (push '("[X]" . "☑") prettify-symbols-alist)
   (push '("[-]" . "❍") prettify-symbols-alist)))
\end{verbatim}

Do not open a new window when editing source.
\begin{verbatim}
(setq org-src-window-setup 'current-window)
\end{verbatim}

Babel.
\begin{verbatim}
(org-babel-do-load-languages
  'org-babel-load-languages
  '((scheme . t)
    (python . t)))
(setq org-confirm-babel-evaluate nil)
\end{verbatim}

\subsubsection{\LaTeX{}}
\label{sec:orgbc5618d}
\begin{verbatim}
(use-package ox
  :ensure nil
  :config
  (setq org-format-latex-options
	(plist-put org-format-latex-options :scale 1.5))
  (setq org-latex-create-formula-image-program 'dvisvgm)
  (setq org-preview-latex-default-process 'dvisvgm))
\end{verbatim}

DocView settings for preview.
\begin{verbatim}
(setq doc-view-resolution 600)
(add-hook 'doc-view-mode-hook 'auto-revert-mode)
(add-hook 'doc-view-mode-hook 'doc-view-fit-width-to-window)
\end{verbatim}

\subsection{Miscellaneous}
\label{sec:orge481ad3}
Visually match parentheses.
\begin{verbatim}
(use-package rainbow-delimiters
  :ensure t
  :config (add-hook 'prog-mode-hook #'rainbow-delimiters-mode))
\end{verbatim}

\section{Miscellaneous}
\label{sec:orgfc5cc44}
\subsection{Other Emacs settings}
\label{sec:org894793b}
Always select the help window.
\begin{verbatim}
(setq help-window-select t)
\end{verbatim}

\subsection{Git}
\label{sec:orgf599dc0}
Use \texttt{Magit}.
\begin{verbatim}
(use-package magit
  :ensure t
  :bind (("C-c g" . magit-file-dispatch))) ; instead of C-c M-g, as recommended by the manual
\end{verbatim}

\subsection{Project management}
\label{sec:org321d8c3}
Use \texttt{projectile}
\begin{verbatim}
(use-package projectile
  :ensure t
  :init (projectile-mode +1)
  :bind (:map projectile-mode-map
	      ("C-c p" . projectile-command-map)))
\end{verbatim}

\subsection{Dired}
\label{sec:orga468f2a}
\begin{verbatim}
(use-package dired
  :ensure nil
  :config (setq dired-kill-when-opening-new-dired-buffer t))
\end{verbatim}

\subsection{Terminal and shell}
\label{sec:orgb5a81bf}
Use \texttt{vterm}.
\begin{verbatim}
(use-package vterm
  :ensure t)
\end{verbatim}
\end{document}